<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hologram 3D — Upload Photo</title
  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.18/dist/lil-gui.min.js"></script>
  <style>
    :root{
      --bg:#06070a;
      --panel:rgba(255,255,255,0.03);
      --accent:#00f6ff;
      --accent2:#7b5cff;
      --glass: rgba(255,255,255,0.04);
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#e6f7ff;background:linear-gradient(180deg,#020205 0%, #081226 100%);}
    .app{display:grid;grid-template-columns:360px 1fr;height:100vh;gap:18px;padding:18px;box-sizing:border-box}

    .panel{background:var(--panel);backdrop-filter:blur(8px);border-radius:14px;padding:18px;color:rgba(255,255,255,0.92);box-shadow:0 6px 30px rgba(2,6,23,0.6);}
    h1{font-size:18px;margin:0 0 8px 0;letter-spacing:0.6px}
    p.sub{margin:6px 0 14px 0;font-size:13px;opacity:0.8}
    .drop{border:2px dashed rgba(255,255,255,0.04);padding:12px;border-radius:10px;text-align:center;cursor:pointer}
    .controls{display:grid;gap:10px;margin-top:12px}
    label{font-size:13px;opacity:0.85}
    input[type=range]{width:100%}
    button.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border:0;padding:10px 12px;border-radius:8px;color:#00121a;font-weight:700;cursor:pointer}
    .small{font-size:12px;color:rgba(255,255,255,0.7)}

    .stage{position:relative;border-radius:14px;overflow:hidden;box-shadow:0 10px 50px rgba(3,7,20,0.6)}
    #renderer{width:100%;height:100%;display:block;background:linear-gradient(180deg, rgba(5,8,20,0.6), rgba(2,5,12,0.6));}

    .hud{position:absolute;left:18px;top:18px;background:var(--glass);padding:8px 12px;border-radius:10px;font-size:13px}
    .credits{position:absolute;right:18px;bottom:18px;background:transparent;color:rgba(255,255,255,0.45);font-size:12px}

    @media(max-width:900px){.app{grid-template-columns:1fr;grid-template-rows:auto 1fr;padding:12px}.panel{order:2}}
  </style>
</head>
<body>
  <div class="app">
    <aside class="panel">
      <h1>Hologram 3D — Upload Photo</h1>
      <p class="sub">Unggah foto Anda. Sistem akan membuat "volumetric slices" untuk efek hologram resolusi tinggi. Putar, zoom, dan sesuaikan efek.</p>

      <div class="drop" id="drop">Klik atau tarik foto ke sini<br><small class="small">JPEG/PNG, maksimal 12MB</small>
        <input id="file" type="file" accept="image/*" style="display:none">
      </div>

      <div class="controls">
        <label>Jumlah slice: <span id="slicesVal">48</span></label>
        <input id="slices" type="range" min="6" max="180" value="48">

        <label>Jarak antar slice: <span id="spacingVal">0.012</span></label>
        <input id="spacing" type="range" min="0.002" max="0.05" step="0.001" value="0.012">

        <label>Glow intensity: <span id="glowVal">0.8</span></label>
        <input id="glow" type="range" min="0" max="2" step="0.01" value="0.8">

        <label>Scanline density: <span id="scanVal">120</span></label>
        <input id="scanlines" type="range" min="8" max="600" value="120">

        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <button class="primary" id="regen">Buat Hologram</button>
          <button id="reset" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit">Reset</button>
          <button id="screenshot" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(0,246,255,0.5);color:var(--accent)">Screenshot</button>
        </div>

        <div style="margin-top:8px;font-size:13px;opacity:0.9">
          <div class="small">Kontrol Kamera: klik & drag untuk rotasi, scroll untuk zoom.</div>
        </div>
      </div>
    </aside>

    <main class="stage">
      <canvas id="renderer"></canvas>
      <div class="hud" id="info">No image loaded</div>
      <div class="credits">Made with ♥ — Hologram demo</div>
    </main>
  </div>

  <script>
    let scene, camera, renderer, controls, sliceGroup;
    let imageTexture;
    const canvas = document.getElementById('renderer');

    function init(){
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
      camera.position.set(0, 0.12, 0.8);

      renderer = new THREE.WebGLRenderer({canvas, antialias:true, alpha:true});
      renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
      renderer.setSize(window.innerWidth - 72, window.innerHeight - 36);
      renderer.outputEncoding = THREE.sRGBEncoding;

      scene.background = new THREE.Color(0x031026);

      const amb = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(amb);
      const dir = new THREE.DirectionalLight(0x99eeff, 0.6);
      dir.position.set(1,1,1);
      scene.add(dir);

      sliceGroup = new THREE.Group();
      scene.add(sliceGroup);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.08;
      controls.minDistance = 0.4;
      controls.maxDistance = 3;

      window.addEventListener('resize', onWindowResize);
      animate();
    }

    function onWindowResize(){
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth - 72, window.innerHeight - 36);
    }

    function animate(){
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    function loadImageAsTexture(file){
      return new Promise((resolve,reject)=>{
        const reader = new FileReader();
        reader.onload = function(e){
          const img = new Image();
          img.onload = ()=>{
            const tex = new THREE.CanvasTexture(img);
            tex.needsUpdate = true;
            tex.anisotropy = renderer.capabilities.getMaxAnisotropy();
            resolve({img,tex});
          };
          img.onerror = reject;
          img.src = e.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    function makeSlices(img, options){
      while(sliceGroup.children.length) sliceGroup.remove(sliceGroup.children[0]);

      const width = img.width;
      const height = img.height;
      const aspect = width / height;

      const sliceCount = Math.max(4, Math.floor(options.slices));

      for(let i=0;i<sliceCount;i++){
        const c = document.createElement('canvas');
        c.width = width;
        c.height = height;
        const cc = c.getContext('2d');
        cc.drawImage(img,0,0);

        const tex = new THREE.CanvasTexture(c);
        tex.needsUpdate = true;
        tex.anisotropy = renderer.capabilities.getMaxAnisotropy();

        const material = new THREE.MeshBasicMaterial({map:tex,transparent:true,opacity:1,depthWrite:false});
        const geometry = new THREE.PlaneGeometry(aspect, 1);
        const mesh = new THREE.Mesh(geometry, material);

        const z = (i - sliceCount/2) * options.spacing;
        mesh.position.set((i - sliceCount/2)*options.offsetX, 0, z);
        sliceGroup.add(mesh);
      }
      sliceGroup.scale.set(0.9,0.9,0.9);
    }

    const fileInput = document.getElementById('file');
    const drop = document.getElementById('drop');
    const info = document.getElementById('info');
    const slicesSlider = document.getElementById('slices');
    const spacingSlider = document.getElementById('spacing');
    const glowSlider = document.getElementById('glow');
    const scanSlider = document.getElementById('scanlines');
    const regenBtn = document.getElementById('regen');
    const resetBtn = document.getElementById('reset');
    const screenshotBtn = document.getElementById('screenshot');

    drop.addEventListener('click', ()=>fileInput.click());
    drop.addEventListener('dragover', e=>{e.preventDefault();drop.style.borderColor='#0af';});
    drop.addEventListener('dragleave', e=>{e.preventDefault();drop.style.borderColor='';});
    drop.addEventListener('drop', e=>{
      e.preventDefault();drop.style.borderColor='';
      const f = e.dataTransfer.files[0]; if(f) handleFile(f);
    });
    fileInput.addEventListener('change', e=>{if(e.target.files[0]) handleFile(e.target.files[0]);});

    function setInfo(t){info.textContent = t}

    async function handleFile(file){
      if(!file.type.startsWith('image/')) return alert('Please upload an image file');
      setInfo('Loading image...');
      try{
        const {img,tex} = await loadImageAsTexture(file);
        imageTexture = tex;
        setInfo('Image loaded — ready to generate');
        window._lastImage = img;
      }catch(err){
        console.error(err);setInfo('Failed to load image');
      }
    }

    regenBtn.addEventListener('click', ()=>{
      if(!window._lastImage) return alert('Silakan unggah foto terlebih dahulu');
      const opts = {
        slices: parseInt(slicesSlider.value,10),
        spacing: parseFloat(spacingSlider.value),
        glow: parseFloat(glowSlider.value),
        scanlines: parseFloat(scanSlider.value),
        jitter: 0.002,
        offsetX: 0.0008
      };
      document.getElementById('slicesVal').textContent = opts.slices;
      document.getElementById('spacingVal').textContent = opts.spacing;
      document.getElementById('glowVal').textContent = opts.glow;
      document.getElementById('scanVal').textContent = opts.scanlines;
      setInfo('Generating hologram — this may take a moment');
      setTimeout(()=>{ 
        makeSlices(window._lastImage, opts);
        setInfo('Hologram siap — gunakan mouse untuk memutar (klik & drag)');
      },50);
    });

    resetBtn.addEventListener('click', ()=>{
      while(sliceGroup.children.length) sliceGroup.remove(sliceGroup.children[0]);
      setInfo('Reset — unggah foto baru');
      window._lastImage = null;
    });

    screenshotBtn.addEventListener('click', ()=>{
      const dataURL = renderer.domElement.toDataURL('image/png');
      const link = document.createElement('a');
      link.href = dataURL;
      link.download = 'hologram_screenshot.png';
      link.click();
    });

    init();
  </script>
</body>
</html>
